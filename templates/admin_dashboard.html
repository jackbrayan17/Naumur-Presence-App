{% extends "base.html" %}
{% load i18n %}

{% block title %}{% trans "Admin Dashboard" %} | Naumur Presence App{% endblock %}

{% block content %}
  <section class="card">
    <div class="card-header">
      <div>
        <h1>{% trans "Admin Dashboard" %}</h1>
        <p class="muted">{% trans "Presence overview by department and employee." %}</p>
      </div>
      <form class="filter-form" method="get">
        <label>
          {% trans "From" %}
          <input type="date" name="start" value="{{ start_date }}" />
        </label>
        <label>
          {% trans "To" %}
          <input type="date" name="end" value="{{ end_date }}" />
        </label>
        <button class="btn btn-outline" type="submit">{% trans "Filter" %}</button>
      </form>
    </div>

    <h2>{% trans "Employee cards" %}</h2>
    <div class="card-grid">
      {% for card in employee_cards %}
        <div
          class="employee-card"
          data-name="{{ card.employee.get_full_name|default:card.employee.username }}"
          data-start="{{ card.start_date }}"
          data-status="{{ card.status }}"
          data-hours="{{ card.present_hours|floatformat:1 }}"
          data-absences="{{ card.absent_days }}"
          data-absent-hours="{{ card.absent_hours|floatformat:1 }}"
        >
          {% if card.employee.profile_image %}
            <img class="avatar-img" src="{{ card.employee.profile_image.url }}" alt="{{ card.employee.get_full_name|default:card.employee.username }}" />
          {% else %}
            <div class="avatar-fallback" style="background: {{ card.employee.avatar_color }};">
              {{ card.employee.initials }}
            </div>
          {% endif %}
          <div class="card-name">{{ card.employee.get_full_name|default:card.employee.username }}</div>
          <div class="card-meta">{{ card.employee.department.name|default:"-" }}</div>
        </div>
      {% empty %}
        <div class="row-muted">{% trans "No employees found." %}</div>
      {% endfor %}
    </div>

    <h2>{% trans "Presence rate by department" %}</h2>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>{% trans "Department" %}</th>
            <th>{% trans "Expected" %}</th>
            <th>{% trans "Present" %}</th>
            <th>{% trans "Rate" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for row in dept_rows %}
            <tr>
              <td>{{ row.department.name|default:"-" }}</td>
              <td>{{ row.expected }}</td>
              <td>{{ row.present }}</td>
              <td>{{ row.rate|floatformat:1 }}%</td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="4" class="row-muted">{% trans "No data available." %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <section class="card">
    <h2>{% trans "Employee presence and absence" %}</h2>
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>{% trans "Employee" %}</th>
            <th>{% trans "Department" %}</th>
            <th>{% trans "Present days" %}</th>
            <th>{% trans "Absent days" %}</th>
            <th>{% trans "Present hours" %}</th>
            <th>{% trans "Absent hours" %}</th>
            <th>{% trans "Actions" %}</th>
          </tr>
        </thead>
        <tbody>
          {% for row in employee_rows %}
            <tr>
              <td>{{ row.employee.get_full_name|default:row.employee.username }}</td>
              <td>{{ row.department.name|default:"-" }}</td>
              <td>{{ row.present_days }}</td>
              <td>{{ row.absent_days }}</td>
              <td>{{ row.present_hours|floatformat:1 }}</td>
              <td>{{ row.absent_hours|floatformat:1 }}</td>
              <td>
                <a class="btn btn-outline" href="{% url 'employee_week' %}?user={{ row.employee.id }}&week={{ current_week_start|date:'Y-m-d' }}">
                  {% trans "Edit week" %}
                </a>
              </td>
            </tr>
          {% empty %}
            <tr>
              <td colspan="7" class="row-muted">{% trans "No employees found." %}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </section>

  <div class="modal" id="employee-modal" aria-hidden="true">
    <div class="modal-card" role="dialog" aria-modal="true" aria-labelledby="modal-title">
      <div class="modal-header">
        <div>
          <h2 id="modal-title">{% trans "Employee details" %}</h2>
          <p class="muted" id="modal-subtitle"></p>
        </div>
        <button class="modal-close" type="button" data-modal-close>x</button>
      </div>
      <div class="modal-grid">
        <div class="modal-item">
          <div class="muted">{% trans "Start date" %}</div>
          <div id="modal-start"></div>
        </div>
        <div class="modal-item">
          <div class="muted">{% trans "Status" %}</div>
          <div id="modal-status"></div>
        </div>
        <div class="modal-item">
          <div class="muted">{% trans "Total hours" %}</div>
          <div id="modal-hours"></div>
        </div>
        <div class="modal-item">
          <div class="muted">{% trans "Total absences" %}</div>
          <div id="modal-absences"></div>
        </div>
        <div class="modal-item">
          <div class="muted">{% trans "Absent hours" %}</div>
          <div id="modal-absent-hours"></div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}
